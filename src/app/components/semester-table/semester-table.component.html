<h2>Calendrier de Semestre</h2>

<div class="container mt-4">
  <div *ngIf="!stepperVisible" class="text-center mt-3">

    <!-- Dropdown Section -->
    <div class="dropdowns row justify-content-center mb-4">
      <div class="col-6 col-md-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Année universitaire</mat-label>
          <mat-select
            [(ngModel)]="selectedYear"
            (selectionChange)="onSelectionChange()"
          >
            <mat-option *ngFor="let year of academicYears" [value]="year">{{
              year
            }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- Table Display -->
    <div
      *ngIf="!loadingSessions && dataSource.length > 0"
      class="table-container mat-elevation-z8"
    >
      <div class="table-responsive">
        <table class="table table-bordered text-center">
          <thead style="background-color: #084981; color: white;" class="table-light">
            <tr>
              <th>Date</th>
              <th>Designation</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of dataSource">
              <td>{{ row.dateDebut }} à {{ row.dateFin }}</td>
              <td>{{ row.designation }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Fallback for No Data -->
    <div
      *ngIf="!loadingSessions && dataSource.length === 0"
      class="alert alert-info text-center my-5"
    >
      <p class="mb-0">
        Veuillez sélectionner une année universitaire.
      </p>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex justify-content-center gap-3 mt-5">
      <button
        mat-raised-button
        style="background-color: #084981; color: white"
        (click)="onAddButtonClick()"
      >
        <mat-icon>add</mat-icon>
        Créer un calendrier de semestre
      </button>
    </div>
  </div>
</div>

    <mat-stepper
      linear
      #stepper
      *ngIf="stepperVisible"
      class="scrollable-stepper"
    >
      <mat-step [stepControl]="firstFormGroup">
        <form [formGroup]="firstFormGroup" (ngSubmit)="onYearSubmit()">
          <ng-template matStepLabel
            >Information de Calendrier de Semestre</ng-template
          >
          <div class="text-center mt-3">
            <mat-form-field appearance="outline" class="w-50 mb-3">
              <mat-label>Année universitaire</mat-label>
              <input
                matInput
                placeholder="Année Universitaire"
                formControlName="firstCtrl"
                required
                name="year"
              />
            </mat-form-field>
          </div>
          <div class="text-center mt-3">
            <button mat-raised-button color="primary" matStepperNext>
              Continuer
            </button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="secondFormGroup">
        <ng-template matStepLabel>Calendrier de Semestre</ng-template>

        <div class="text-center mt-3">
          <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
            <ng-container matColumnDef="dateDebut">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let element">
                {{ element.dateDebut }} à {{ element.dateFin }}
              </td>
            </ng-container>

            <ng-container matColumnDef="designation">
              <th mat-header-cell *matHeaderCellDef>Designation</th>
              <td mat-cell *matCellDef="let element">
                {{ element.designation }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
        </div>

        <form [formGroup]="secondFormGroup">
          <div class="text-center mt-3">
            <button mat-raised-button class="m-2" matStepperPrevious>
              Retour
            </button>
            <button mat-raised-button color="primary" matStepperNext>
              Continuer
            </button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="thirdFormGroup">
        <ng-template matStepLabel>Ajouter une ligne</ng-template>
        <form [formGroup]="thirdFormGroup" (ngSubmit)="addSemesterRow()">
          <div class="text-center mt-3">
            <mat-form-field appearance="outline" class="w-50 mb-3">
              <mat-label>Date Début</mat-label>
              <input
                matInput
                [matDatepicker]="pickerStart"
                formControlName="dateDebut"
                required
              />
              <mat-hint>MM/DD/YYYY</mat-hint>
              <mat-datepicker-toggle matIconSuffix [for]="pickerStart">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #pickerStart></mat-datepicker> </mat-form-field
            ><br />
            <mat-form-field appearance="outline" class="w-50 mb-3">
              <mat-label>Date Fin</mat-label>
              <input
                matInput
                [matDatepicker]="pickerEnd"
                formControlName="dateFin"
                required
              />
              <mat-hint>MM/DD/YYYY</mat-hint>
              <mat-datepicker-toggle matIconSuffix [for]="pickerEnd">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #pickerEnd></mat-datepicker> </mat-form-field
            ><br />
            <mat-form-field appearance="outline" class="w-50 mb-3">
              <mat-label>Designation</mat-label>
              <input
                matInput
                formControlName="designation"
                required
              /> </mat-form-field
            ><br />
          </div>
          <div class="text-center mt-3">
            <button mat-raised-button class="m-2" matStepperPrevious>
              Retour
            </button>
            <button mat-raised-button color="primary" matStepperNext>
              Ajouter
            </button>
          </div>
        </form>
      </mat-step>
    </mat-stepper>
